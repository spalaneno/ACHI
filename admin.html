<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>ACHI - Admin Approval</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
      font-size: 14px;
    }

    th {
      background: #222;
      color: white;
    }

    button {
      padding: 6px 10px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      border-radius: 4px;
    }

    .approve {
      background: #2ecc71;
      color: white;
    }

    .reject {
      background: #e74c3c;
      color: white;
    }

    .loading {
      text-align: center;
      margin-top: 30px;
      font-style: italic;
    }
  </style>
</head>
<body>

<h2>ADMIN APPROVAL ANFRAKAN</h2>

<div id="loading" class="loading">Memuat data...</div>

<table id="table" style="display:none;">
  <thead>
    <tr>
      <th>Tanggal</th>
      <th>Kapal</th>
      <th>User</th>
      <th>Keterangan</th>
      <th>Nominal</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="data"></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxh4rEWK9NyUVOl6o7ndt8sGBxOG8mwFhrY6pz5xL9I5QM3-o1rh1Ina1OtuPmFpw50/exec";

// ==========================
// LOAD DATA
// ==========================
function loadData() {
  fetch(API_URL + "?action=getPendingAnfrakan")
    .then(res => res.json())
    .then(json => {
      document.getElementById("loading").style.display = "none";

      if (json.status !== "success" || json.data.length === 0) {
        document.getElementById("loading").innerText = "Tidak ada anfrakan pending";
        document.getElementById("loading").style.display = "block";
        return;
      }

      document.getElementById("table").style.display = "table";

      const tbody = document.getElementById("data");
      tbody.innerHTML = "";

      json.data.forEach(item => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${new Date(item.tanggal).toLocaleDateString()}</td>
          <td>${item.kapal}</td>
          <td>${item.username}</td>
          <td>${item.keterangan}</td>
          <td>Rp ${Number(item.nominal).toLocaleString()}</td>
          <td>
            <button class="approve" onclick="approve(${item.row})">Approve</button>
            <button class="reject" onclick="reject(${item.row})">Reject</button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      document.getElementById("loading").innerText = "Gagal memuat data";
      console.error(err);
    });
}

// ==========================
// APPROVE
// ==========================
function approve(row) {
  if (!confirm("Setujui anfrakan ini?")) return;

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "approveAnfrakan",
      row: row
    })
  })
  .then(res => res.json())
  .then(() => {
    alert("Anfrakan disetujui");
    loadData();
  })
  .catch(() => alert("Koneksi gagal"));
}

// ==========================
// REJECT
// ==========================
function reject(row) {
  if (!confirm("Tolak anfrakan ini?")) return;

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "rejectAnfrakan",
      row: row
    })
  })
  .then(res => res.json())
  .then(() => {
    alert("Anfrakan ditolak");
    loadData();
  })
  .catch(() => alert("Koneksi gagal"));
}

// LOAD SAAT HALAMAN DIBUKA
loadData();
</script>

</body>
</html>
